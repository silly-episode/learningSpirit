<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boot.learningspirit.dao.ClassDao">

    <resultMap type="com.boot.learningspirit.entity.BanJi" id="ClassMap">
        <result property="classId" column="class_id" jdbcType="INTEGER"/>
        <result property="className" column="class_name" jdbcType="VARCHAR"/>
        <result property="classNum" column="class_num" jdbcType="INTEGER"/>
        <result property="classCreator" column="class_creator" jdbcType="INTEGER"/>
        <result property="classAdmin" column="class_admin" jdbcType="INTEGER"/>
        <result property="classCreateTime" column="class_create_time" jdbcType="TIMESTAMP"/>
        <result property="joined" column="joined" jdbcType="INTEGER"/>
    </resultMap>

    <!-- 批量插入 -->
    <insert id="insertBatch" keyProperty="classId" useGeneratedKeys="true">
        insert into learningspirit.ban_ji(class_name, class_num, class_creator, class_admin, class_create_time, joined)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.className}, #{entity.classNum}, #{entity.classCreator}, #{entity.classAdmin},
            #{entity.classCreateTime}, #{entity.joined})
        </foreach>
    </insert>
    <!-- 批量插入或按主键更新 -->
    <insert id="insertOrUpdateBatch" keyProperty="classId" useGeneratedKeys="true">
        insert into learningspirit.ban_ji(class_name, class_num, class_creator, class_admin, class_create_time, joined)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.className}, #{entity.classNum}, #{entity.classCreator}, #{entity.classAdmin},
            #{entity.classCreateTime}, #{entity.joined})
        </foreach>
        on duplicate key update
        class_name = values(class_name) , class_num = values(class_num) , class_creator = values(class_creator) ,
        class_admin = values(class_admin) , class_create_time = values(class_create_time) , joined = values(joined)
    </insert>


    <select id="getBanJiList" resultType="com.boot.learningspirit.entity.BanJi">
        select b.*
        from learningspirit.class_member m
                 left join learningspirit.ban_ji b on m.class_id = b.class_id
        where m.open_id = #{openId}
    </select>

</mapper>

